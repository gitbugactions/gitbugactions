{"repository": "jboss-modules/jboss-modules", "clone_url": "https://github.com/jboss-modules/jboss-modules.git", "timestamp": "2023-05-31T21:30:24.928113Z", "commit_hash": "df880a65df21a2d32b35f5a353ca930f7a3e63d2", "commit_message": "Fix local loader to reflect slot\n", "related_issues": "", "bug_patch": "diff --git a/src/main/java/org/jboss/modules/LocalModuleLoader.java b/src/main/java/org/jboss/modules/LocalModuleLoader.java\nindex 2daa33e..153e84b 100644\n--- a/src/main/java/org/jboss/modules/LocalModuleLoader.java\n+++ b/src/main/java/org/jboss/modules/LocalModuleLoader.java\n@@ -58,6 +58,7 @@ public final class LocalModuleLoader extends ModuleLoader {\n     private static String toPathString(ModuleIdentifier moduleIdentifier) {\n         final StringBuilder builder = new StringBuilder();\n         builder.append(moduleIdentifier.getName().replace('.', File.separatorChar));\n+        builder.append(File.separatorChar).append(moduleIdentifier.getSlot());\n         builder.append(File.separatorChar);\n         return builder.toString();\n     }\ndiff --git a/src/test/resources/test/repo/test/bad-deps/main/module.xml b/src/test/resources/test/repo/test/bad-deps/main/module.xml\nnew file mode 100644\nindex 0000000..7f57bb7\n--- /dev/null\n+++ b/src/test/resources/test/repo/test/bad-deps/main/module.xml\n@@ -0,0 +1,33 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  -->\n+\n+<module xmlns=\"urn:jboss:module:1.0\" name=\"test.bad-deps\">\n+    <resources>\n+        <!-- Insert resources here -->\n+    </resources>\n+\n+    <dependencies>\n+        <module name=\"missing\"/>\n+    </dependencies>\n+</module>\ndiff --git a/src/test/resources/test/repo/test/circular-deps-A/main/module.xml b/src/test/resources/test/repo/test/circular-deps-A/main/module.xml\nnew file mode 100644\nindex 0000000..b9be493\n--- /dev/null\n+++ b/src/test/resources/test/repo/test/circular-deps-A/main/module.xml\n@@ -0,0 +1,34 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  -->\n+\n+<module xmlns=\"urn:jboss:module:1.0\" name=\"test.circular-deps-A\">\n+    <resources>\n+        <!-- Insert resources here -->\n+    </resources>\n+\n+    <dependencies>\n+        <module name=\"test.circular-deps-B\"/>\n+        <module name=\"test.circular-deps-A\"/>\n+    </dependencies>\n+</module>\ndiff --git a/src/test/resources/test/repo/test/circular-deps-B/main/module.xml b/src/test/resources/test/repo/test/circular-deps-B/main/module.xml\nnew file mode 100644\nindex 0000000..28942d5\n--- /dev/null\n+++ b/src/test/resources/test/repo/test/circular-deps-B/main/module.xml\n@@ -0,0 +1,33 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  -->\n+\n+<module xmlns=\"urn:jboss:module:1.0\" name=\"test.circular-deps-B\">\n+    <resources>\n+        <!-- Insert resources here -->\n+    </resources>\n+\n+    <dependencies>\n+        <module name=\"test.circular-deps-C\"/>\n+    </dependencies>\n+</module>\ndiff --git a/src/test/resources/test/repo/test/circular-deps-C/main/module.xml b/src/test/resources/test/repo/test/circular-deps-C/main/module.xml\nnew file mode 100644\nindex 0000000..0aacb8e\n--- /dev/null\n+++ b/src/test/resources/test/repo/test/circular-deps-C/main/module.xml\n@@ -0,0 +1,34 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  -->\n+\n+<module xmlns=\"urn:jboss:module:1.0\" name=\"test.circular-deps-C\">\n+    <resources>\n+        <!-- Insert resources here -->\n+    </resources>\n+\n+    <dependencies>\n+        <module name=\"test.circular-deps-D\"/>\n+        <module name=\"test.circular-deps-A\"/>\n+    </dependencies>\n+</module>\ndiff --git a/src/test/resources/test/repo/test/circular-deps-D/main/module.xml b/src/test/resources/test/repo/test/circular-deps-D/main/module.xml\nnew file mode 100644\nindex 0000000..0b883f0\n--- /dev/null\n+++ b/src/test/resources/test/repo/test/circular-deps-D/main/module.xml\n@@ -0,0 +1,33 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  -->\n+\n+<module xmlns=\"urn:jboss:module:1.0\" name=\"test.circular-deps-D\">\n+    <resources>\n+        <!-- Insert resources here -->\n+    </resources>\n+\n+    <dependencies>\n+        <module name=\"test.circular-deps-A\"/>\n+    </dependencies>\n+</module>\ndiff --git a/src/test/resources/test/repo/test/test/main/module.xml b/src/test/resources/test/repo/test/test/main/module.xml\nnew file mode 100644\nindex 0000000..27c6528\n--- /dev/null\n+++ b/src/test/resources/test/repo/test/test/main/module.xml\n@@ -0,0 +1,32 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  -->\n+\n+<module xmlns=\"urn:jboss:module:1.0\" name=\"test.test\">\n+    <resources>\n+        <!-- Insert resources here -->\n+    </resources>\n+\n+    <dependencies>\n+    </dependencies>\n+</module>\ndiff --git a/src/test/resources/test/repo/test/with-deps/main/module.xml b/src/test/resources/test/repo/test/with-deps/main/module.xml\nnew file mode 100644\nindex 0000000..4e975dd\n--- /dev/null\n+++ b/src/test/resources/test/repo/test/with-deps/main/module.xml\n@@ -0,0 +1,33 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  -->\n+\n+<module xmlns=\"urn:jboss:module:1.0\" name=\"test.with-deps\">\n+    <resources>\n+        <!-- Insert resources here -->\n+    </resources>\n+\n+    <dependencies>\n+        <module name=\"test.test\"/>\n+    </dependencies>\n+</module>\n", "test_patch": "diff --git a/src/test/resources/test/repo/test/bad-deps/module.xml b/src/test/resources/test/repo/test/bad-deps/module.xml\ndeleted file mode 100644\nindex 7f57bb7..0000000\n--- a/src/test/resources/test/repo/test/bad-deps/module.xml\n+++ /dev/null\n@@ -1,33 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-\n-<!--\n-  ~ JBoss, Home of Professional Open Source.\n-  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n-  ~ as indicated by the @author tags. See the copyright.txt file in the\n-  ~ distribution for a full listing of individual contributors.\n-  ~\n-  ~ This is free software; you can redistribute it and/or modify it\n-  ~ under the terms of the GNU Lesser General Public License as\n-  ~ published by the Free Software Foundation; either version 2.1 of\n-  ~ the License, or (at your option) any later version.\n-  ~\n-  ~ This software is distributed in the hope that it will be useful,\n-  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n-  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n-  ~ Lesser General Public License for more details.\n-  ~\n-  ~ You should have received a copy of the GNU Lesser General Public\n-  ~ License along with this software; if not, write to the Free\n-  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n-  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-  -->\n-\n-<module xmlns=\"urn:jboss:module:1.0\" name=\"test.bad-deps\">\n-    <resources>\n-        <!-- Insert resources here -->\n-    </resources>\n-\n-    <dependencies>\n-        <module name=\"missing\"/>\n-    </dependencies>\n-</module>\ndiff --git a/src/test/resources/test/repo/test/circular-deps-A/module.xml b/src/test/resources/test/repo/test/circular-deps-A/module.xml\ndeleted file mode 100644\nindex b9be493..0000000\n--- a/src/test/resources/test/repo/test/circular-deps-A/module.xml\n+++ /dev/null\n@@ -1,34 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-\n-<!--\n-  ~ JBoss, Home of Professional Open Source.\n-  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n-  ~ as indicated by the @author tags. See the copyright.txt file in the\n-  ~ distribution for a full listing of individual contributors.\n-  ~\n-  ~ This is free software; you can redistribute it and/or modify it\n-  ~ under the terms of the GNU Lesser General Public License as\n-  ~ published by the Free Software Foundation; either version 2.1 of\n-  ~ the License, or (at your option) any later version.\n-  ~\n-  ~ This software is distributed in the hope that it will be useful,\n-  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n-  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n-  ~ Lesser General Public License for more details.\n-  ~\n-  ~ You should have received a copy of the GNU Lesser General Public\n-  ~ License along with this software; if not, write to the Free\n-  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n-  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-  -->\n-\n-<module xmlns=\"urn:jboss:module:1.0\" name=\"test.circular-deps-A\">\n-    <resources>\n-        <!-- Insert resources here -->\n-    </resources>\n-\n-    <dependencies>\n-        <module name=\"test.circular-deps-B\"/>\n-        <module name=\"test.circular-deps-A\"/>\n-    </dependencies>\n-</module>\ndiff --git a/src/test/resources/test/repo/test/circular-deps-B/module.xml b/src/test/resources/test/repo/test/circular-deps-B/module.xml\ndeleted file mode 100644\nindex 28942d5..0000000\n--- a/src/test/resources/test/repo/test/circular-deps-B/module.xml\n+++ /dev/null\n@@ -1,33 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-\n-<!--\n-  ~ JBoss, Home of Professional Open Source.\n-  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n-  ~ as indicated by the @author tags. See the copyright.txt file in the\n-  ~ distribution for a full listing of individual contributors.\n-  ~\n-  ~ This is free software; you can redistribute it and/or modify it\n-  ~ under the terms of the GNU Lesser General Public License as\n-  ~ published by the Free Software Foundation; either version 2.1 of\n-  ~ the License, or (at your option) any later version.\n-  ~\n-  ~ This software is distributed in the hope that it will be useful,\n-  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n-  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n-  ~ Lesser General Public License for more details.\n-  ~\n-  ~ You should have received a copy of the GNU Lesser General Public\n-  ~ License along with this software; if not, write to the Free\n-  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n-  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-  -->\n-\n-<module xmlns=\"urn:jboss:module:1.0\" name=\"test.circular-deps-B\">\n-    <resources>\n-        <!-- Insert resources here -->\n-    </resources>\n-\n-    <dependencies>\n-        <module name=\"test.circular-deps-C\"/>\n-    </dependencies>\n-</module>\ndiff --git a/src/test/resources/test/repo/test/circular-deps-C/module.xml b/src/test/resources/test/repo/test/circular-deps-C/module.xml\ndeleted file mode 100644\nindex 0aacb8e..0000000\n--- a/src/test/resources/test/repo/test/circular-deps-C/module.xml\n+++ /dev/null\n@@ -1,34 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-\n-<!--\n-  ~ JBoss, Home of Professional Open Source.\n-  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n-  ~ as indicated by the @author tags. See the copyright.txt file in the\n-  ~ distribution for a full listing of individual contributors.\n-  ~\n-  ~ This is free software; you can redistribute it and/or modify it\n-  ~ under the terms of the GNU Lesser General Public License as\n-  ~ published by the Free Software Foundation; either version 2.1 of\n-  ~ the License, or (at your option) any later version.\n-  ~\n-  ~ This software is distributed in the hope that it will be useful,\n-  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n-  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n-  ~ Lesser General Public License for more details.\n-  ~\n-  ~ You should have received a copy of the GNU Lesser General Public\n-  ~ License along with this software; if not, write to the Free\n-  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n-  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-  -->\n-\n-<module xmlns=\"urn:jboss:module:1.0\" name=\"test.circular-deps-C\">\n-    <resources>\n-        <!-- Insert resources here -->\n-    </resources>\n-\n-    <dependencies>\n-        <module name=\"test.circular-deps-D\"/>\n-        <module name=\"test.circular-deps-A\"/>\n-    </dependencies>\n-</module>\ndiff --git a/src/test/resources/test/repo/test/circular-deps-D/module.xml b/src/test/resources/test/repo/test/circular-deps-D/module.xml\ndeleted file mode 100644\nindex 0b883f0..0000000\n--- a/src/test/resources/test/repo/test/circular-deps-D/module.xml\n+++ /dev/null\n@@ -1,33 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-\n-<!--\n-  ~ JBoss, Home of Professional Open Source.\n-  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n-  ~ as indicated by the @author tags. See the copyright.txt file in the\n-  ~ distribution for a full listing of individual contributors.\n-  ~\n-  ~ This is free software; you can redistribute it and/or modify it\n-  ~ under the terms of the GNU Lesser General Public License as\n-  ~ published by the Free Software Foundation; either version 2.1 of\n-  ~ the License, or (at your option) any later version.\n-  ~\n-  ~ This software is distributed in the hope that it will be useful,\n-  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n-  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n-  ~ Lesser General Public License for more details.\n-  ~\n-  ~ You should have received a copy of the GNU Lesser General Public\n-  ~ License along with this software; if not, write to the Free\n-  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n-  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-  -->\n-\n-<module xmlns=\"urn:jboss:module:1.0\" name=\"test.circular-deps-D\">\n-    <resources>\n-        <!-- Insert resources here -->\n-    </resources>\n-\n-    <dependencies>\n-        <module name=\"test.circular-deps-A\"/>\n-    </dependencies>\n-</module>\ndiff --git a/src/test/resources/test/repo/test/test/module.xml b/src/test/resources/test/repo/test/test/module.xml\ndeleted file mode 100644\nindex 27c6528..0000000\n--- a/src/test/resources/test/repo/test/test/module.xml\n+++ /dev/null\n@@ -1,32 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-\n-<!--\n-  ~ JBoss, Home of Professional Open Source.\n-  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n-  ~ as indicated by the @author tags. See the copyright.txt file in the\n-  ~ distribution for a full listing of individual contributors.\n-  ~\n-  ~ This is free software; you can redistribute it and/or modify it\n-  ~ under the terms of the GNU Lesser General Public License as\n-  ~ published by the Free Software Foundation; either version 2.1 of\n-  ~ the License, or (at your option) any later version.\n-  ~\n-  ~ This software is distributed in the hope that it will be useful,\n-  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n-  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n-  ~ Lesser General Public License for more details.\n-  ~\n-  ~ You should have received a copy of the GNU Lesser General Public\n-  ~ License along with this software; if not, write to the Free\n-  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n-  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-  -->\n-\n-<module xmlns=\"urn:jboss:module:1.0\" name=\"test.test\">\n-    <resources>\n-        <!-- Insert resources here -->\n-    </resources>\n-\n-    <dependencies>\n-    </dependencies>\n-</module>\ndiff --git a/src/test/resources/test/repo/test/with-deps/module.xml b/src/test/resources/test/repo/test/with-deps/module.xml\ndeleted file mode 100644\nindex 4e975dd..0000000\n--- a/src/test/resources/test/repo/test/with-deps/module.xml\n+++ /dev/null\n@@ -1,33 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-\n-<!--\n-  ~ JBoss, Home of Professional Open Source.\n-  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n-  ~ as indicated by the @author tags. See the copyright.txt file in the\n-  ~ distribution for a full listing of individual contributors.\n-  ~\n-  ~ This is free software; you can redistribute it and/or modify it\n-  ~ under the terms of the GNU Lesser General Public License as\n-  ~ published by the Free Software Foundation; either version 2.1 of\n-  ~ the License, or (at your option) any later version.\n-  ~\n-  ~ This software is distributed in the hope that it will be useful,\n-  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n-  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n-  ~ Lesser General Public License for more details.\n-  ~\n-  ~ You should have received a copy of the GNU Lesser General Public\n-  ~ License along with this software; if not, write to the Free\n-  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n-  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-  -->\n-\n-<module xmlns=\"urn:jboss:module:1.0\" name=\"test.with-deps\">\n-    <resources>\n-        <!-- Insert resources here -->\n-    </resources>\n-\n-    <dependencies>\n-        <module name=\"test.test\"/>\n-    </dependencies>\n-</module>\n"}
{"repository": "jboss-modules/jboss-modules", "clone_url": "https://github.com/jboss-modules/jboss-modules.git", "timestamp": "2023-05-31T21:36:24.714336Z", "commit_hash": "962c99c1d9c48fdf601eed4f5025b4edac076439", "commit_message": "Fix various test failures\n", "related_issues": "", "bug_patch": "diff --git a/src/main/java/org/jboss/modules/FileResourceLoader.java b/src/main/java/org/jboss/modules/FileResourceLoader.java\nindex 66bd8e2..527d23d 100644\n--- a/src/main/java/org/jboss/modules/FileResourceLoader.java\n+++ b/src/main/java/org/jboss/modules/FileResourceLoader.java\n@@ -121,6 +121,18 @@ final class FileResourceLoader implements ResourceLoader {\n     private final PathFilter exportFilter;\n \n     FileResourceLoader(final ModuleIdentifier moduleIdentifier, final File root, final String rootName, final PathFilter exportFilter) {\n+        if (moduleIdentifier == null) {\n+            throw new IllegalArgumentException(\"moduleIdentifier is null\");\n+        }\n+        if (root == null) {\n+            throw new IllegalArgumentException(\"root is null\");\n+        }\n+        if (rootName == null) {\n+            throw new IllegalArgumentException(\"rootName is null\");\n+        }\n+        if (exportFilter == null) {\n+            throw new IllegalArgumentException(\"exportFilter is null\");\n+        }\n         this.moduleIdentifier = moduleIdentifier;\n         this.rootName = rootName;\n         this.root = root;\ndiff --git a/src/main/java/org/jboss/modules/JarFileResourceLoader.java b/src/main/java/org/jboss/modules/JarFileResourceLoader.java\nindex 51d68b3..0ebf042 100644\n--- a/src/main/java/org/jboss/modules/JarFileResourceLoader.java\n+++ b/src/main/java/org/jboss/modules/JarFileResourceLoader.java\n@@ -55,6 +55,18 @@ final class JarFileResourceLoader implements ResourceLoader {\n     private final PathFilter exportFilter;\n \n     JarFileResourceLoader(final ModuleIdentifier moduleIdentifier, final JarFile jarFile, final String rootName, final PathFilter exportFilter) {\n+        if (moduleIdentifier == null) {\n+            throw new IllegalArgumentException(\"moduleIdentifier is null\");\n+        }\n+        if (jarFile == null) {\n+            throw new IllegalArgumentException(\"jarFile is null\");\n+        }\n+        if (rootName == null) {\n+            throw new IllegalArgumentException(\"rootName is null\");\n+        }\n+        if (exportFilter == null) {\n+            throw new IllegalArgumentException(\"exportFilter is null\");\n+        }\n         this.jarFile = jarFile;\n         this.rootName = rootName;\n         this.moduleIdentifier = moduleIdentifier;\ndiff --git a/src/main/java/org/jboss/modules/Module.java b/src/main/java/org/jboss/modules/Module.java\nindex 546cee8..b2ab487 100644\n--- a/src/main/java/org/jboss/modules/Module.java\n+++ b/src/main/java/org/jboss/modules/Module.java\n@@ -42,6 +42,7 @@ import java.util.List;\n import java.util.Map;\n import java.util.ServiceLoader;\n import java.util.Set;\n+import java.util.concurrent.atomic.AtomicReferenceFieldUpdater;\n \n /**\n * A module is a unit of classes and other resources, along with the specification of what is imported and exported\n@@ -160,6 +161,8 @@ public final class Module {\n \n     private volatile LoadState loadState = LoadState.LOADED;\n \n+    private static final AtomicReferenceFieldUpdater<Module, LoadState> loadStateUpdater = AtomicReferenceFieldUpdater.newUpdater(Module.class, LoadState.class, \"loadState\");\n+\n     void resolveInitial(Set<Module> visited) throws ModuleLoadException {\n         if (loadState.compareTo(LoadState.RESOLVED) >= 0) {\n             return;\n@@ -312,10 +315,12 @@ public final class Module {\n         for (Dependency dependency : dependencies) {\n             dependency.accept(firstLevelVisitor);\n         }\n+        paths = new Paths(allPaths, exportedPaths);\n+        loadStateUpdater.compareAndSet(this, LoadState.LOADED, LoadState.RESOLVED);\n     }\n \n     void linkInitial(final HashSet<Module> visited) throws ModuleLoadException {\n-        if (loadState.compareTo(LoadState.RESOLVED) >= 0) {\n+        if (loadState.compareTo(LoadState.LINKED) >= 0) {\n             return;\n         }\n         link(visited);\n@@ -737,7 +742,7 @@ public final class Module {\n      * @return the name of the corresponding class file\n      */\n     static String fileNameOfClass(final String className) {\n-        return pathOfClass(className) + \".class\";\n+        return className.replace('.', '/') + \".class\";\n     }\n \n     /**\ndiff --git a/src/main/java/org/jboss/modules/ModuleLoader.java b/src/main/java/org/jboss/modules/ModuleLoader.java\nindex 6788317..4874092 100644\n--- a/src/main/java/org/jboss/modules/ModuleLoader.java\n+++ b/src/main/java/org/jboss/modules/ModuleLoader.java\n@@ -38,13 +38,6 @@ import static org.jboss.modules.ConcurrentReferenceHashMap.ReferenceType.WEAK;\n  */\n public abstract class ModuleLoader {\n \n-    private static final ThreadLocal<Map<ModuleIdentifier, Module>> VISITED = new ThreadLocal<Map<ModuleIdentifier, Module>>() {\n-        @Override\n-        protected Map<ModuleIdentifier, Module> initialValue() {\n-            return new HashMap<ModuleIdentifier, Module>();\n-        }\n-    };\n-\n     private final ConcurrentMap<ModuleIdentifier, FutureModule> moduleMap = new ConcurrentReferenceHashMap<ModuleIdentifier, FutureModule>(\n             256, 0.5f, 32, STRONG, WEAK, EnumSet.noneOf(ConcurrentReferenceHashMap.Option.class)\n     );\n@@ -176,8 +169,6 @@ public abstract class ModuleLoader {\n             throw new IllegalStateException(\"Attempted to define a module from outside loadModuleLocal\");\n         }\n         final Module module = new Module(moduleSpec, this);\n-        final Map<ModuleIdentifier, Module> visited = VISITED.get();\n-        visited.put(moduleIdentifier, module);\n         try {\n             futureModule.setModule(module);\n             return module;\n@@ -190,8 +181,6 @@ public abstract class ModuleLoader {\n         } catch (Error e) {\n             log.trace(e, \"Failed to load module %s\", moduleIdentifier);\n             throw e;\n-        } finally {\n-            visited.remove(moduleIdentifier);\n         }\n     }\n \ndiff --git a/src/main/java/org/jboss/modules/ModuleSpec.java b/src/main/java/org/jboss/modules/ModuleSpec.java\nindex e0fa597..0f4fb39 100644\n--- a/src/main/java/org/jboss/modules/ModuleSpec.java\n+++ b/src/main/java/org/jboss/modules/ModuleSpec.java\n@@ -211,6 +211,9 @@ public final class ModuleSpec {\n \n             @Override\n             public ModuleSpec create() {\n+                if (! localAdded) {\n+                    addLocalDependency();\n+                }\n                 return new ModuleSpec(moduleIdentifier, mainClass, assertionSetting, resourceLoaders.toArray(new ResourceLoader[resourceLoaders.size()]), dependencies.toArray(new SpecifiedDependency[dependencies.size()]));\n             }\n \ndiff --git a/src/main/java/org/jboss/modules/ModuleXmlParser.java b/src/main/java/org/jboss/modules/ModuleXmlParser.java\nindex 82942ec..3d15374 100644\n--- a/src/main/java/org/jboss/modules/ModuleXmlParser.java\n+++ b/src/main/java/org/jboss/modules/ModuleXmlParser.java\n@@ -317,6 +317,7 @@ final class ModuleXmlParser {\n         while (reader.hasNext()) {\n             switch (reader.nextTag()) {\n                 case XMLStreamConstants.END_ELEMENT: {\n+                    specBuilder.addLocalDependency();\n                     return;\n                 }\n                 case XMLStreamConstants.START_ELEMENT: {\n@@ -364,6 +365,9 @@ final class ModuleXmlParser {\n         while (reader.hasNext()) {\n             switch (reader.nextTag()) {\n                 case XMLStreamConstants.END_ELEMENT: {\n+                    dependencySpecBuilder.setExportFilter(export ? PathFilters.all(exportFilters) : PathFilter.REJECT_ALL);\n+                    dependencySpecBuilder.setImportFilter(PathFilters.all(importFilters));\n+                    specBuilder.addModuleDependency(dependencySpecBuilder.create());\n                     return;\n                 }\n                 case XMLStreamConstants.START_ELEMENT: {\n@@ -379,9 +383,6 @@ final class ModuleXmlParser {\n                 }\n             }\n         }\n-        dependencySpecBuilder.setExportFilter(export ? PathFilters.all(exportFilters) : PathFilter.REJECT_ALL);\n-        dependencySpecBuilder.setImportFilter(PathFilters.all(importFilters));\n-        specBuilder.addModuleDependency(dependencySpecBuilder.create());\n     }\n \n     private static void parseMainClass(final XMLStreamReader reader, final ModuleSpec.Builder specBuilder) throws XMLStreamException {\n", "test_patch": "diff --git a/src/test/java/org/jboss/modules/AbstractModuleTestCase.java b/src/test/java/org/jboss/modules/AbstractModuleTestCase.java\nindex 5080a7c..52013db 100644\n--- a/src/test/java/org/jboss/modules/AbstractModuleTestCase.java\n+++ b/src/test/java/org/jboss/modules/AbstractModuleTestCase.java\n@@ -44,7 +44,7 @@ public class AbstractModuleTestCase {\n     @BeforeClass\n     public static void initUrlHandler() {\n         // this also kicks off Module's static init\n-        Module.setModuleLogger(new StreamModuleLogger(System.out));\n+        Module.setModuleLogger(new StreamModuleLogger(System.err));\n     }\n \n     protected File getResource(final String path) throws Exception {\ndiff --git a/src/test/java/org/jboss/modules/AbstractResourceLoaderTestCase.java b/src/test/java/org/jboss/modules/AbstractResourceLoaderTestCase.java\nindex 773e270..6fe9012 100644\n--- a/src/test/java/org/jboss/modules/AbstractResourceLoaderTestCase.java\n+++ b/src/test/java/org/jboss/modules/AbstractResourceLoaderTestCase.java\n@@ -51,7 +51,7 @@ public abstract class AbstractResourceLoaderTestCase extends AbstractModuleTestC\n         loader = createLoader(PathFilter.ACCEPT_ALL);\n     }\n \n-    protected abstract ResourceLoader createLoader(final PathFilter pathFilter) throws Exception;\n+    protected abstract ResourceLoader createLoader(final PathFilter exportFilter) throws Exception;\n     protected abstract void assertResource(final Resource resource, final String fileName);\n \n     @Test\ndiff --git a/src/test/java/org/jboss/modules/FileResourceLoaderTest.java b/src/test/java/org/jboss/modules/FileResourceLoaderTest.java\nindex 477d415..795018d 100644\n--- a/src/test/java/org/jboss/modules/FileResourceLoaderTest.java\n+++ b/src/test/java/org/jboss/modules/FileResourceLoaderTest.java\n@@ -35,11 +35,11 @@ public class FileResourceLoaderTest extends AbstractResourceLoaderTestCase {\n \n     private File resourceRoot;\n \n-    protected ResourceLoader createLoader(final PathFilter pathFilter) throws Exception {\n+    protected ResourceLoader createLoader(final PathFilter exportFilter) throws Exception {\n         resourceRoot = getResource(\"test/fileresourceloader\");\n         // Copy the classfile over\n         copyResource(\"org/jboss/modules/test/TestClass.class\", \"test/fileresourceloader\", \"org/jboss/modules/test\");\n-        return new FileResourceLoader(MODULE_ID, resourceRoot, \"test-root\", pathFilter);\n+        return new FileResourceLoader(MODULE_ID, resourceRoot, \"test-root\", exportFilter);\n     }\n \n     @Override\n@@ -49,6 +49,10 @@ public class FileResourceLoaderTest extends AbstractResourceLoaderTestCase {\n         Assert.assertEquals(resourceFile.length(), resource.getSize());\n     }\n \n+    public void testGetClassSpec() throws Exception {\n+        super.testGetClassSpec();\n+    }\n+\n     protected File getExpectedFile(String fileName) {\n         return new File(resourceRoot, fileName);\n     }\ndiff --git a/src/test/java/org/jboss/modules/JarResourceLoaderTest.java b/src/test/java/org/jboss/modules/JarResourceLoaderTest.java\nindex b14c550..7fc84b4 100644\n--- a/src/test/java/org/jboss/modules/JarResourceLoaderTest.java\n+++ b/src/test/java/org/jboss/modules/JarResourceLoaderTest.java\n@@ -42,7 +42,7 @@ public class JarResourceLoaderTest extends AbstractResourceLoaderTestCase {\n \n     private JarFile jarFile;\n \n-    protected ResourceLoader createLoader(final PathFilter pathFilter) throws Exception {\n+    protected ResourceLoader createLoader(final PathFilter exportFilter) throws Exception {\n         File fileResourceRoot = getResource(\"test/fileresourceloader\");\n         // Copy the classfile over\n         copyResource(\"org/jboss/modules/test/TestClass.class\", \"test/fileresourceloader\", \"org/jboss/modules/test\");\n@@ -53,7 +53,7 @@ public class JarResourceLoaderTest extends AbstractResourceLoaderTestCase {\n         buildJar(fileResourceRoot, outputFile);\n         // Create the jar file and resource loader\n         jarFile = new JarFile(outputFile);\n-        return new JarFileResourceLoader(MODULE_ID, jarFile, \"test-root\", pathFilter);\n+        return new JarFileResourceLoader(MODULE_ID, jarFile, \"test-root\", exportFilter);\n     }\n \n     @Override\ndiff --git a/src/test/java/org/jboss/modules/LocalModuleLoaderTest.java b/src/test/java/org/jboss/modules/LocalModuleLoaderTest.java\nindex 694ad17..7a53b76 100644\n--- a/src/test/java/org/jboss/modules/LocalModuleLoaderTest.java\n+++ b/src/test/java/org/jboss/modules/LocalModuleLoaderTest.java\n@@ -42,6 +42,7 @@ public class LocalModuleLoaderTest extends AbstractModuleTestCase {\n     public void setupModuleLoader() throws Exception {\n         final File repoRoot = getResource(\"test/repo\");\n         moduleLoader = new LocalModuleLoader(new File[] {repoRoot});\n+        Module.setModuleLoaderSelector(new SimpleModuleLoaderSelector(moduleLoader));\n     }\n \n     @Test\ndiff --git a/src/test/java/org/jboss/modules/ModuleClassLoaderTest.java b/src/test/java/org/jboss/modules/ModuleClassLoaderTest.java\nindex d832e96..f683857 100644\n--- a/src/test/java/org/jboss/modules/ModuleClassLoaderTest.java\n+++ b/src/test/java/org/jboss/modules/ModuleClassLoaderTest.java\n@@ -150,6 +150,8 @@ public class ModuleClassLoaderTest extends AbstractModuleTestCase {\n                 .setExportFilter(PathFilter.ACCEPT_ALL)\n                 .create());\n         moduleLoader.addModuleSpec(moduleWithCircularDBuilder.create());\n+\n+        Module.setModuleLoaderSelector(new SimpleModuleLoaderSelector(moduleLoader));\n     }\n \n     @Test\ndiff --git a/src/test/java/org/jboss/modules/util/TestResourceLoader.java b/src/test/java/org/jboss/modules/util/TestResourceLoader.java\nindex 175d426..654b7a2 100644\n--- a/src/test/java/org/jboss/modules/util/TestResourceLoader.java\n+++ b/src/test/java/org/jboss/modules/util/TestResourceLoader.java\n@@ -55,7 +55,6 @@ public class TestResourceLoader implements ResourceLoader {\n     private final Map<String, ClassSpec> classSpecs = new HashMap<String, ClassSpec>();\n     private final Map<String, Resource> resources = new HashMap<String, Resource>();\n     private Set<String> paths = new HashSet<String>();\n-    private PathFilter exportFilter;\n     private Manifest manifest;\n \n     public String getRootName() {\n@@ -140,11 +139,7 @@ public class TestResourceLoader implements ResourceLoader {\n \n     @Override\n     public PathFilter getExportFilter() {\n-        return exportFilter;\n-    }\n-\n-    void setExportFilter(final PathFilter exportFilter) {\n-        this.exportFilter = exportFilter;\n+        return PathFilter.ACCEPT_ALL;\n     }\n \n     @Override\n"}
{"repository": "jboss-modules/jboss-modules", "clone_url": "https://github.com/jboss-modules/jboss-modules.git", "timestamp": "2023-05-31T21:54:00.484527Z", "commit_hash": "3cdbf2ae9c8564db592cce3a145b56dafa1e426d", "commit_message": "Fixed bug in module->module local class load call\n", "related_issues": "", "bug_patch": "diff --git a/src/main/java/org/jboss/modules/ModuleClassLoader.java b/src/main/java/org/jboss/modules/ModuleClassLoader.java\nindex 8f29b29..0e2a9e8 100644\n--- a/src/main/java/org/jboss/modules/ModuleClassLoader.java\n+++ b/src/main/java/org/jboss/modules/ModuleClassLoader.java\n@@ -170,7 +170,7 @@ public class ModuleClassLoader extends ConcurrentClassLoader {\n                log.trace(\"Attempting to getImportedClass [\" + className + \"] from [\" + dependency + \"] ...\");\n \n             try {\n-                Class<?> importedClass = dependency.getClassLoader().loadClassLocal(className, exportsOnly);\n+                Class<?> importedClass = dependency.getClassLoader().loadClassLocal(className, true, exportsOnly);\n                 if(importedClass != null) {\n                    if (traceEnabled == true)\n                       log.trace(\"Found getImportedClass [\" + className + \"] from [\" + dependency + \"]\");\n@@ -182,6 +182,18 @@ public class ModuleClassLoader extends ConcurrentClassLoader {\n     }\n \n     private Class<?> loadClassLocal(final String className, final boolean exportOnly) throws ClassNotFoundException {\n+        return loadClassLocal(className, false, exportOnly);\n+    }\n+\n+    private Class<?> loadClassLocal(final String className, final boolean checkPreviouslyLoaded, final boolean exportOnly) throws ClassNotFoundException {\n+        if(checkPreviouslyLoaded) {\n+            // Check if we have already loaded it..\n+            Class<?> loadedClass = findLoadedClass(className);\n+            if (loadedClass != null) {\n+                return loadedClass;\n+            }\n+        }\n+\n         if(exportOnly) {\n             final String path = getPathFromClassName(className);\n             final Set<String> exportedPaths = module.getExportedPaths();\ndiff --git a/src/test/resources/test/repo/test/test-circular-deps-A/1.0/module.xml b/src/test/resources/test/repo/test/test-circular-deps-A/1.0/module.xml\nnew file mode 100644\nindex 0000000..3b4c60c\n--- /dev/null\n+++ b/src/test/resources/test/repo/test/test-circular-deps-A/1.0/module.xml\n@@ -0,0 +1,34 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  -->\n+\n+<module xmlns=\"urn:jboss:module:1.0\" name=\"test-circular-deps-A\" group=\"test\" version=\"1.0\">\n+    <resources>\n+        <!-- Insert resources here -->\n+    </resources>\n+\n+    <dependencies>\n+        <module group=\"test\" name=\"test-circular-deps-B\" version=\"1.0\"/>\n+        <module group=\"test\" name=\"test-circular-deps-A\" version=\"1.0\"/>\n+    </dependencies>\n+</module>\ndiff --git a/src/test/resources/test/repo/test/test-circular-deps-B/1.0/module.xml b/src/test/resources/test/repo/test/test-circular-deps-B/1.0/module.xml\nnew file mode 100644\nindex 0000000..07d39f8\n--- /dev/null\n+++ b/src/test/resources/test/repo/test/test-circular-deps-B/1.0/module.xml\n@@ -0,0 +1,33 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  -->\n+\n+<module xmlns=\"urn:jboss:module:1.0\" name=\"test-circular-deps-B\" group=\"test\" version=\"1.0\">\n+    <resources>\n+        <!-- Insert resources here -->\n+    </resources>\n+\n+    <dependencies>\n+        <module group=\"test\" name=\"test-circular-deps-C\" version=\"1.0\"/>\n+    </dependencies>\n+</module>\ndiff --git a/src/test/resources/test/repo/test/test-circular-deps-C/1.0/module.xml b/src/test/resources/test/repo/test/test-circular-deps-C/1.0/module.xml\nnew file mode 100644\nindex 0000000..c9a78b7\n--- /dev/null\n+++ b/src/test/resources/test/repo/test/test-circular-deps-C/1.0/module.xml\n@@ -0,0 +1,34 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  -->\n+\n+<module xmlns=\"urn:jboss:module:1.0\" name=\"test-circular-deps-C\" group=\"test\" version=\"1.0\">\n+    <resources>\n+        <!-- Insert resources here -->\n+    </resources>\n+\n+    <dependencies>\n+        <module group=\"test\" name=\"test-circular-deps-D\" version=\"1.0\"/>\n+        <module group=\"test\" name=\"test-circular-deps-A\" version=\"1.0\"/>\n+    </dependencies>\n+</module>\ndiff --git a/src/test/resources/test/repo/test/test-circular-deps-D/1.0/module.xml b/src/test/resources/test/repo/test/test-circular-deps-D/1.0/module.xml\nnew file mode 100644\nindex 0000000..671e276\n--- /dev/null\n+++ b/src/test/resources/test/repo/test/test-circular-deps-D/1.0/module.xml\n@@ -0,0 +1,33 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  -->\n+\n+<module xmlns=\"urn:jboss:module:1.0\" name=\"test-circular-deps-D\" group=\"test\" version=\"1.0\">\n+    <resources>\n+        <!-- Insert resources here -->\n+    </resources>\n+\n+    <dependencies>\n+        <module group=\"test\" name=\"test-circular-deps-A\" version=\"1.0\"/>\n+    </dependencies>\n+</module>\n", "test_patch": "diff --git a/src/test/java/org/jboss/modules/LocalModuleLoaderTest.java b/src/test/java/org/jboss/modules/LocalModuleLoaderTest.java\nindex abf2e01..694ad17 100644\n--- a/src/test/java/org/jboss/modules/LocalModuleLoaderTest.java\n+++ b/src/test/java/org/jboss/modules/LocalModuleLoaderTest.java\n@@ -66,7 +66,9 @@ public class LocalModuleLoaderTest extends AbstractModuleTestCase {\n \n     @Test\n     public void testLoadWithCircularDeps() throws Exception {\n-        assertNotNull(moduleLoader.loadModule(new ModuleIdentifier(\"test\", \"test-circular-deps\", \"1.0\")));\n-        assertNotNull(moduleLoader.loadModule(new ModuleIdentifier(\"test\", \"test-circular-deps-other\", \"1.0\")));\n+        assertNotNull(moduleLoader.loadModule(new ModuleIdentifier(\"test\", \"test-circular-deps-A\", \"1.0\")));\n+        assertNotNull(moduleLoader.loadModule(new ModuleIdentifier(\"test\", \"test-circular-deps-B\", \"1.0\")));\n+        assertNotNull(moduleLoader.loadModule(new ModuleIdentifier(\"test\", \"test-circular-deps-C\", \"1.0\")));\n+        assertNotNull(moduleLoader.loadModule(new ModuleIdentifier(\"test\", \"test-circular-deps-D\", \"1.0\")));\n     }\n }\ndiff --git a/src/test/java/org/jboss/modules/ModuleClassLoaderTest.java b/src/test/java/org/jboss/modules/ModuleClassLoaderTest.java\nindex ed021a7..cedf362 100644\n--- a/src/test/java/org/jboss/modules/ModuleClassLoaderTest.java\n+++ b/src/test/java/org/jboss/modules/ModuleClassLoaderTest.java\n@@ -55,6 +55,8 @@ public class ModuleClassLoaderTest extends AbstractModuleTestCase {\n \n     private static final ModuleIdentifier MODULE_WITH_CIRCULAR_DEP_A = new ModuleIdentifier(\"test\", \"test-with-circular-dep-a\", \"1.0\");\n     private static final ModuleIdentifier MODULE_WITH_CIRCULAR_DEP_B = new ModuleIdentifier(\"test\", \"test-with-circular-dep-b\", \"1.0\");\n+    private static final ModuleIdentifier MODULE_WITH_CIRCULAR_DEP_C = new ModuleIdentifier(\"test\", \"test-with-circular-dep-c\", \"1.0\");\n+    private static final ModuleIdentifier MODULE_WITH_CIRCULAR_DEP_D = new ModuleIdentifier(\"test\", \"test-with-circular-dep-d\", \"1.0\");\n \n     private TestModuleLoader moduleLoader;\n \n@@ -110,8 +112,18 @@ public class ModuleClassLoaderTest extends AbstractModuleTestCase {\n                  .addClass(ImportedClass.class)\n                  .create()\n         );\n-        moduleWithCircularBBuilder.addDependency(MODULE_WITH_CIRCULAR_DEP_A).setExport(true);\n+        moduleWithCircularBBuilder.addDependency(MODULE_WITH_CIRCULAR_DEP_C).setExport(true);\n         moduleLoader.addModuleSpec(moduleWithCircularBBuilder.create());\n+\n+\n+        final ModuleSpec.Builder moduleWithCircularCBuilder = ModuleSpec.build(MODULE_WITH_CIRCULAR_DEP_C);\n+        moduleWithCircularCBuilder.addDependency(MODULE_WITH_CIRCULAR_DEP_D).setExport(true);\n+        moduleWithCircularCBuilder.addDependency(MODULE_WITH_CIRCULAR_DEP_A).setExport(true);\n+        moduleLoader.addModuleSpec(moduleWithCircularCBuilder.create());\n+\n+        final ModuleSpec.Builder moduleWithCircularDBuilder = ModuleSpec.build(MODULE_WITH_CIRCULAR_DEP_D);\n+        moduleWithCircularDBuilder.addDependency(MODULE_WITH_CIRCULAR_DEP_A).setExport(true);\n+        moduleLoader.addModuleSpec(moduleWithCircularDBuilder.create());\n     }\n \n     @Test\n@@ -190,12 +202,27 @@ public class ModuleClassLoaderTest extends AbstractModuleTestCase {\n     public void testCircularClassLoad() throws Exception {\n         final Module moduleA = moduleLoader.loadModule(MODULE_WITH_CIRCULAR_DEP_A);\n         final ModuleClassLoader classLoaderA = moduleA.getClassLoader();\n-        final Module moduleB = moduleLoader.loadModule(MODULE_WITH_CIRCULAR_DEP_B);\n-        final ModuleClassLoader classLoaderB = moduleB.getClassLoader();\n         Class<?> testClass = classLoaderA.loadExportedClass(\"org.jboss.modules.test.ImportedClass\");\n         assertNotNull(testClass);\n+\n+        final Module moduleB = moduleLoader.loadModule(MODULE_WITH_CIRCULAR_DEP_B);\n+        final ModuleClassLoader classLoaderB = moduleB.getClassLoader();\n         testClass = classLoaderB.loadExportedClass(\"org.jboss.modules.test.TestClass\");\n         assertNotNull(testClass);\n+\n+        final Module moduleC = moduleLoader.loadModule(MODULE_WITH_CIRCULAR_DEP_C);\n+        final ModuleClassLoader classLoaderC = moduleC.getClassLoader();\n+        testClass = classLoaderC.loadExportedClass(\"org.jboss.modules.test.TestClass\");\n+        assertNotNull(testClass);\n+        testClass = classLoaderC.loadExportedClass(\"org.jboss.modules.test.ImportedClass\");\n+        assertNotNull(testClass);\n+\n+        final Module moduleD = moduleLoader.loadModule(MODULE_WITH_CIRCULAR_DEP_D);\n+        final ModuleClassLoader classLoaderD = moduleC.getClassLoader();\n+        testClass = classLoaderD.loadExportedClass(\"org.jboss.modules.test.TestClass\");\n+        assertNotNull(testClass);\n+        testClass = classLoaderD.loadExportedClass(\"org.jboss.modules.test.ImportedClass\");\n+        assertNotNull(testClass);\n     }\n \n     @Test\ndiff --git a/src/test/resources/test/repo/test/test-circular-deps-other/1.0/module.xml b/src/test/resources/test/repo/test/test-circular-deps-other/1.0/module.xml\ndeleted file mode 100644\nindex f904940..0000000\n--- a/src/test/resources/test/repo/test/test-circular-deps-other/1.0/module.xml\n+++ /dev/null\n@@ -1,33 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-\n-<!--\n-  ~ JBoss, Home of Professional Open Source.\n-  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n-  ~ as indicated by the @author tags. See the copyright.txt file in the\n-  ~ distribution for a full listing of individual contributors.\n-  ~\n-  ~ This is free software; you can redistribute it and/or modify it\n-  ~ under the terms of the GNU Lesser General Public License as\n-  ~ published by the Free Software Foundation; either version 2.1 of\n-  ~ the License, or (at your option) any later version.\n-  ~\n-  ~ This software is distributed in the hope that it will be useful,\n-  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n-  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n-  ~ Lesser General Public License for more details.\n-  ~\n-  ~ You should have received a copy of the GNU Lesser General Public\n-  ~ License along with this software; if not, write to the Free\n-  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n-  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-  -->\n-\n-<module xmlns=\"urn:jboss:module:1.0\" name=\"test-circular-deps-other\" group=\"test\" version=\"1.0\">\n-    <resources>\n-        <!-- Insert resources here -->\n-    </resources>\n-\n-    <dependencies>\n-        <module group=\"test\" name=\"test-circular-deps\" version=\"1.0\"/>\n-    </dependencies>\n-</module>\ndiff --git a/src/test/resources/test/repo/test/test-circular-deps/1.0/module.xml b/src/test/resources/test/repo/test/test-circular-deps/1.0/module.xml\ndeleted file mode 100644\nindex 7e9807c..0000000\n--- a/src/test/resources/test/repo/test/test-circular-deps/1.0/module.xml\n+++ /dev/null\n@@ -1,33 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-\n-<!--\n-  ~ JBoss, Home of Professional Open Source.\n-  ~ Copyright 2010, Red Hat, Inc., and individual contributors\n-  ~ as indicated by the @author tags. See the copyright.txt file in the\n-  ~ distribution for a full listing of individual contributors.\n-  ~\n-  ~ This is free software; you can redistribute it and/or modify it\n-  ~ under the terms of the GNU Lesser General Public License as\n-  ~ published by the Free Software Foundation; either version 2.1 of\n-  ~ the License, or (at your option) any later version.\n-  ~\n-  ~ This software is distributed in the hope that it will be useful,\n-  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n-  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n-  ~ Lesser General Public License for more details.\n-  ~\n-  ~ You should have received a copy of the GNU Lesser General Public\n-  ~ License along with this software; if not, write to the Free\n-  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n-  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-  -->\n-\n-<module xmlns=\"urn:jboss:module:1.0\" name=\"test-circular-deps\" group=\"test\" version=\"1.0\">\n-    <resources>\n-        <!-- Insert resources here -->\n-    </resources>\n-\n-    <dependencies>\n-        <module group=\"test\" name=\"test-circular-deps-other\" version=\"1.0\"/>\n-    </dependencies>\n-</module>\n"}
