{"repository": "tdunning/t-digest", "clone_url": "https://github.com/tdunning/t-digest.git", "timestamp": "2023-05-30T19:27:08.041323Z", "commit_hash": "d05568e86ad163f2b519f443c9b5e2dc69989a9c", "commit_message": "Closes #92 Fixed code and test to do consistent serialization\n", "related_issues": "", "bug_patch": "diff --git a/src/main/java/com/tdunning/math/stats/AVLTreeDigest.java b/src/main/java/com/tdunning/math/stats/AVLTreeDigest.java\nindex aa8c792..2a56276 100644\n--- a/src/main/java/com/tdunning/math/stats/AVLTreeDigest.java\n+++ b/src/main/java/com/tdunning/math/stats/AVLTreeDigest.java\n@@ -315,7 +315,7 @@ public class AVLTreeDigest extends AbstractTDigest {\n      */\n     @Override\n     public int byteSize() {\n-        return 4 + 8 * 2 + 4 + 4 + summary.size() * 12;\n+        return 4 + 8 * 2 + 8 + 4 + summary.size() * 12;\n     }\n \n     /**\n@@ -341,7 +341,7 @@ public class AVLTreeDigest extends AbstractTDigest {\n         buf.putInt(VERBOSE_ENCODING);\n         buf.putDouble(min);\n         buf.putDouble(max);\n-        buf.putFloat((float) compression());\n+        buf.putDouble((float) compression());\n         buf.putInt(summary.size());\n         for (Centroid centroid : summary) {\n             buf.putDouble(centroid.mean());\n", "test_patch": "diff --git a/src/test/java/com/tdunning/math/stats/TDigestTest.java b/src/test/java/com/tdunning/math/stats/TDigestTest.java\nindex 005df07..9a482b6 100644\n--- a/src/test/java/com/tdunning/math/stats/TDigestTest.java\n+++ b/src/test/java/com/tdunning/math/stats/TDigestTest.java\n@@ -624,11 +624,6 @@ public abstract class TDigestTest extends AbstractTest {\n         dist.asBytes(buf);\n         assertTrue(buf.position() < 11000);\n         assertEquals(dist.byteSize(), buf.position());\n-        buf.clear();\n-\n-        dist.asSmallBytes(buf);\n-        assertTrue(buf.position() < 6000);\n-        assertEquals(buf.position(), dist.smallByteSize());\n \n         System.out.printf(\"# big %d bytes\\n\", buf.position());\n \n"}
